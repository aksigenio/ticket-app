<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Купить билет</title>

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:12px;background:#fafafa}
h2{margin:6px 0 12px}
.topbar{max-width:980px;margin:0 auto 8px;display:flex;justify-content:space-between;align-items:center}
.legend{display:flex;gap:12px}
.legend span{display:inline-flex;align-items:center;gap:6px;font-size:.9rem}
.sw{width:14px;height:14px;border-radius:3px;display:inline-block}
.hall{position:relative;max-width:980px;margin:10px auto;height:1400px;background:#fff;border:1px solid #eee}
.stage{position:absolute;left:8%;right:8%;top:4%;height:16%;background:#e8e0cb;display:flex;align-items:center;justify-content:center;font-weight:700}
.seat{position:absolute;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:.7rem;color:#fff;cursor:pointer}
.available{background:#00a000}
.pending{background:#f0a000}
.sold{background:#c00000;cursor:default}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center}
.modal.open{display:flex}
.card{background:#fff;padding:14px;border-radius:8px;width:90%;max-width:420px}
input{width:100%;margin-top:6px;padding:8px}
.btn{padding:8px 12px;border:none;border-radius:6px;background:#1e73be;color:#fff}
.btn.grey{background:#777}
</style>
</head>

<body>

<div class="topbar">
  <h2>Купить билет</h2>
</div>

<div class="hall" id="hall">
  <div class="stage">PALCO / Сцена</div>
</div>

<div id="modal" class="modal">
  <div class="card">
    <h3 id="modalTitle"></h3>
    <form id="buyForm">
      <input type="hidden" id="seatId">

      <input type="text" id="name" placeholder="Имя" required>
      <input type="text" id="surname" placeholder="Фамилия">
      <input type="email" id="email" placeholder="Email" required>

      <input type="file" id="receipt" required accept="image/*,application/pdf">

      <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
        <button type="button" class="btn grey" onclick="modal.classList.remove('open')">Отмена</button>
        <button type="submit" class="btn">Отправить</button>
      </div>

      <div id="formMsg"></div>
    </form>
  </div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyCqNfxFr7e1Z9SupVChk7oL5ldZHtCTdD-WYiECvI5U35p1FgT83VFgIEj4p4HfMrx/exec';
const modal = document.getElementById('modal');
const formMsg = document.getElementById('formMsg');

function openModal(id){
  seatId.value = id;
  modalTitle.textContent = 'Выбрано место ' + id;
  modal.classList.add('open');
}

document.getElementById('buyForm').onsubmit = e => {
  e.preventDefault();
  formMsg.textContent = 'Отправка…';

  const file = receipt.files[0];
  const reader = new FileReader();

  reader.onload = async () => {
    const base64 = reader.result.split(',')[1];

    const fd = new FormData();
    fd.append('type','reserve');
    fd.append('id',seatId.value);
    fd.append('name',name.value);
    fd.append('surname',surname.value);
    fd.append('email',email.value);
    fd.append('receiptBase64', base64);
    fd.append('receiptMime', file.type);

    const r = await fetch(API_URL,{method:'POST',body:fd});
    const j = await r.json();

    formMsg.textContent = j.ok ? 'Резерв принят' : 'Ошибка: ' + j.error;
    if(j.ok) setTimeout(()=>modal.classList.remove('open'),800);
  };

  reader.readAsDataURL(file);
};
</script>

</body>
</html>



















