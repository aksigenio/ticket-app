<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Купить билет</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:12px;background:#fafafa}
  h2{margin:6px 0 12px}
  .legend{display:flex;gap:12px;margin-bottom:10px;align-items:center}
  .legend span{display:inline-flex;align-items:center;gap:6px;font-size:0.95rem}
  .sw{width:14px;height:14px;border-radius:3px;display:inline-block}
  .hall{position:relative;max-width:980px;margin:10px auto;height:1400px;background:#fff;border:1px solid #eee;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
  .stage{position:absolute; left:8%; right:8%; top:4%; height:16%; background:#e8e0cb; display:flex;align-items:center;justify-content:center; font-weight:700; color:#333; border-radius:4px}
  .seat{position:absolute;border-radius:6px; display:flex;align-items:center;justify-content:center;color:#fff;font-size:0.7rem;cursor:pointer;box-shadow:0 1px 0 rgba(0,0,0,0.08);border:2px solid rgba(255,255,255,0.6)}
  .available{background:rgba(0,160,0,0.9)}
  .pending{background:rgba(240,160,0,0.95)}
  .sold{background:rgba(200,0,0,0.95);cursor:default;opacity:0.85}
  .seat:hover{transform:scale(1.06)}
  .modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:9999}
  .modal.open{display:flex}
  .card{background:#fff;padding:14px;border-radius:8px;width:90%;max-width:420px;box-shadow:0 6px 24px rgba(0,0,0,0.2)}
  input[type=text], input[type=email]{width:100%;padding:8px;margin-top:6px;box-sizing:border-box}
  input[type=file]{margin-top:8px}
  .btn{padding:8px 12px;border-radius:6px;border:none;background:#1e73be;color:#fff;cursor:pointer}
  .btn.grey{background:#777}
  #formMsg{margin-top:8px;font-size:0.95rem}
  .topbar{max-width:980px;margin:0 auto 8px;display:flex;justify-content:space-between;align-items:center}
  @media (max-width:600px){ .seat{font-size:0.6rem} }
</style>
</head>
<body>
  <div class="topbar">
    <h2>Купить билет — план зала</h2>
    <div class="legend">
      <span><i class="sw" style="background:rgba(0,160,0,0.9)"></i> available</span>
      <span><i class="sw" style="background:rgba(240,160,0,0.95)"></i> pending</span>
      <span><i class="sw" style="background:rgba(200,0,0,0.95)"></i> sold</span>
    </div>
  </div>

  <div class="hall" id="hall">
    <div class="stage">PALCO / Сцена</div>
    <!-- seats will be added here -->
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="card">
      <h3 id="modalTitle">Заказать место</h3>
      <form id="buyForm">
        <input type="hidden" id="seatId" />
        <label>Имя<input type="text" id="name" required></label>
        <label>Фамилия<input type="text" id="surname"></label>
        <label>Email<input type="email" id="email" required></label>
        <label>Подтверждение оплаты (скрин/файл)*<input type="file" id="receipt" accept="image/*,application/pdf" required></label>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
          <button id="cancelBtn" class="btn grey" type="button">Отмена</button>
          <button class="btn" type="submit">Отправить</button>
        </div>
        <div id="formMsg"></div>
      </form>
    </div>
  </div>

<script>
/* ---------- ВСТАВЬ СЮДА ТВОЙ API URL ------------- */
const API_URL = 'https://script.google.com/macros/s/AKfycbyB8BTuStNLun7ZSM3WEkVhqvkKXQA6dJOdKrtmR8scnCphRakjkmLuQtm6-ja2MjX5HA/exec'; // <-- ВСТАВЬ Web app URL

/* ---------- СХЕМА РЯДОВ (сумма = 172) -----------
   rowsCounts — массив: кол-во кресел в каждом ряду, сверху вниз */
const rowsCounts = [16,15,15,15,14,12,12,12,12,12,10,10,8,9]; // total 172

/* Параметры размещения (проценты) */
const hallPaddingLeft = 6;   // % слева рамки
const hallPaddingRight = 6;  // % справа рамки
const topStart = 22;         // % от верхней границы блока hall, где начинаются ряды
const rowVGap = 4.5;         // вертикальный шаг между рядами (%)
const seatW = 3.5;           // ширина места (%)
const seatH = 3.5;           // высота (%)

/* Авто-генерация SEATS_CONFIG (id,left,top,w,h) */
const SEATS_CONFIG = [
  {
    "id": "1",
    "left": 7.3911,
    "top": 26.9941,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "2",
    "left": 12.6913,
    "top": 26.8809,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "3",
    "left": 16.1949,
    "top": 26.9941,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "4",
    "left": 20.9814,
    "top": 27.2795,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "5",
    "left": 27.1351,
    "top": 27.4508,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "6",
    "left": 32.7764,
    "top": 27.3366,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "7",
    "left": 38.5876,
    "top": 27.4508,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "8",
    "left": 44.2289,
    "top": 27.5078,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "9",
    "left": 48.5873,
    "top": 27.3366,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "10",
    "left": 54.0574,
    "top": 27.2795,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "11",
    "left": 60.2124,
    "top": 27.2225,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "12",
    "left": 66.1949,
    "top": 27.3937,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "13",
    "left": 70.5533,
    "top": 27.3366,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "14",
    "left": 77.5618,
    "top": 27.0512,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "15",
    "left": 84.7415,
    "top": 27.0512,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "16",
    "left": 90.2972,
    "top": 27.0512,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "17",
    "left": 2.6046,
    "top": 32.2399,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "18",
    "left": 7.3055,
    "top": 32.4103,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "19",
    "left": 12.2632,
    "top": 32.3541,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "20",
    "left": 16.2805,
    "top": 32.5244,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "21",
    "left": 21.7506,
    "top": 32.4103,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "22",
    "left": 27.1351,
    "top": 32.5244,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "23",
    "left": 32.6908,
    "top": 32.4674,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "24",
    "left": 38.1609,
    "top": 32.5815,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "25",
    "left": 43.8878,
    "top": 32.4674,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "26",
    "left": 48.6729,
    "top": 32.4674,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "27",
    "left": 54.0574,
    "top": 32.4674,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "28",
    "left": 60.1268,
    "top": 32.4103,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "29",
    "left": 66.0236,
    "top": 32.5244,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "30",
    "left": 69.9553,
    "top": 32.8098,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "31",
    "left": 76.4515,
    "top": 32.5815,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "32",
    "left": 83.7155,
    "top": 32.6957,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "33",
    "left": 90.4685,
    "top": 32.6957,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "34",
    "left": 6.9644,
    "top": 38.3972,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "35",
    "left": 12.1776,
    "top": 38.1118,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "36",
    "left": 16.8785,
    "top": 38.1689,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "37",
    "left": 22.5198,
    "top": 38.283,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "38",
    "left": 27.4775,
    "top": 38.283,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "39",
    "left": 32.2627,
    "top": 38.3401,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "40",
    "left": 38.1609,
    "top": 38.3401,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "41",
    "left": 43.8022,
    "top": 37.9976,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "42",
    "left": 48.503,
    "top": 38.283,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "43",
    "left": 53.8875,
    "top": 38.226,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "44",
    "left": 59.9556,
    "top": 38.3401,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "45",
    "left": 65.7668,
    "top": 37.9406,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "46",
    "left": 70.2978,
    "top": 38.1118,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "47",
    "left": 76.1946,
    "top": 38.283,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "48",
    "left": 83.2887,
    "top": 38.1118,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "49",
    "left": 90.2972,
    "top": 38.0547,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "50",
    "left": 12.1776,
    "top": 43.4138,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "51",
    "left": 16.3661,
    "top": 43.4138,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "52",
    "left": 21.9218,
    "top": 43.585,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "53",
    "left": 27.1351,
    "top": 43.4709,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "54",
    "left": 31.9216,
    "top": 43.4138,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "55",
    "left": 38.1609,
    "top": 43.3005,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "56",
    "left": 43.5453,
    "top": 43.4138,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "57",
    "left": 47.8181,
    "top": 43.3005,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "58",
    "left": 54.0574,
    "top": 43.6421,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "59",
    "left": 60.2124,
    "top": 43.1864,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "60",
    "left": 65.7668,
    "top": 43.1293,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "61",
    "left": 70.6389,
    "top": 43.0722,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "62",
    "left": 75.6823,
    "top": 43.3567,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "63",
    "left": 82.9463,
    "top": 43.4138,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "64",
    "left": 89.7849,
    "top": 43.3567,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "65",
    "left": 16.3661,
    "top": 48.0888,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "66",
    "left": 21.5794,
    "top": 48.0888,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "67",
    "left": 27.2207,
    "top": 48.3171,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "68",
    "left": 31.9216,
    "top": 48.1459,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "69",
    "left": 38.0752,
    "top": 48.1459,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "70",
    "left": 43.6309,
    "top": 48.1459,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "71",
    "left": 48.5873,
    "top": 48.1459,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "72",
    "left": 54.143,
    "top": 47.9755,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "73",
    "left": 60.4679,
    "top": 48.0888,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "74",
    "left": 65.8524,
    "top": 48.2029,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "75",
    "left": 70.8958,
    "top": 47.8614,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "76",
    "left": 76.2802,
    "top": 48.0317,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "77",
    "left": 82.6908,
    "top": 47.8614,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "78",
    "left": 89.7849,
    "top": 48.0317,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "79",
    "left": 15.938,
    "top": 53.3346,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "80",
    "left": 21.3225,
    "top": 53.4487,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "81",
    "left": 27.4775,
    "top": 53.6762,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "82",
    "left": 31.8359,
    "top": 53.562,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "83",
    "left": 37.904,
    "top": 53.6762,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "84",
    "left": 43.9721,
    "top": 53.3346,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "85",
    "left": 48.6729,
    "top": 53.562,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "86",
    "left": 53.9731,
    "top": 53.562,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "87",
    "left": 60.8104,
    "top": 53.3346,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "88",
    "left": 65.0832,
    "top": 53.3346,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "89",
    "left": 70.9814,
    "top": 53.3346,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "90",
    "left": 76.4515,
    "top": 53.4487,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "91",
    "left": 83.2031,
    "top": 53.3346,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "92",
    "left": 89.8705,
    "top": 53.1634,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "93",
    "left": 16.1949,
    "top": 57.9525,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "94",
    "left": 21.9218,
    "top": 58.0096,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "95",
    "left": 27.733,
    "top": 58.1238,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "96",
    "left": 32.3483,
    "top": 58.0096,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "97",
    "left": 37.306,
    "top": 57.8954,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "98",
    "left": 43.8878,
    "top": 57.9525,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "99",
    "left": 48.8442,
    "top": 58.1238,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "100",
    "left": 53.8875,
    "top": 57.8954,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "101",
    "left": 60.6392,
    "top": 57.9525,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "102",
    "left": 65.3401,
    "top": 58.0096,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "103",
    "left": 70.9814,
    "top": 58.0096,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "104",
    "left": 76.7926,
    "top": 57.9525,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "105",
    "left": 83.1175,
    "top": 57.8954,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "106",
    "left": 89.7849,
    "top": 57.8384,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "107",
    "left": 22.1773,
    "top": 62.5134,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "108",
    "left": 27.5618,
    "top": 62.3992,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "109",
    "left": 32.2627,
    "top": 62.5134,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "110",
    "left": 37.3916,
    "top": 62.6846,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "111",
    "left": 43.6309,
    "top": 62.7988,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "112",
    "left": 48.6729,
    "top": 62.6275,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "113",
    "left": 54.2287,
    "top": 62.5705,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "114",
    "left": 60.2124,
    "top": 62.5134,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "115",
    "left": 65.5113,
    "top": 62.7417,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "116",
    "left": 71.067,
    "top": 62.912,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "117",
    "left": 77.3063,
    "top": 62.912,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "118",
    "left": 83.3744,
    "top": 62.7417,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "119",
    "left": 89.9548,
    "top": 62.7417,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "120",
    "left": 37.7328,
    "top": 67.3596,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "121",
    "left": 43.2885,
    "top": 67.3596,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "122",
    "left": 49.101,
    "top": 67.53,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "123",
    "left": 54.3143,
    "top": 67.7012,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "124",
    "left": 59.9556,
    "top": 67.6441,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "125",
    "left": 66.0236,
    "top": 67.7012,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "126",
    "left": 72.0061,
    "top": 67.6441,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "127",
    "left": 77.3063,
    "top": 67.587,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "128",
    "left": 83.46,
    "top": 67.3596,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "129",
    "left": 90.2972,
    "top": 67.6441,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "130",
    "left": 32.862,
    "top": 72.0917,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "131",
    "left": 37.8184,
    "top": 72.0917,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "132",
    "left": 43.6309,
    "top": 71.8634,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "133",
    "left": 49.101,
    "top": 71.8063,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "134",
    "left": 54.3999,
    "top": 71.7493,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "135",
    "left": 60.3823,
    "top": 71.9205,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "136",
    "left": 66.6216,
    "top": 72.1488,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "137",
    "left": 72.1773,
    "top": 71.9776,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "138",
    "left": 77.8187,
    "top": 71.9205,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "139",
    "left": 83.3744,
    "top": 72.0917,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "140",
    "left": 90.2972,
    "top": 72.2059,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "141",
    "left": 38.3321,
    "top": 76.5955,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "142",
    "left": 43.8878,
    "top": 76.5384,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "143",
    "left": 49.1866,
    "top": 76.5955,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "144",
    "left": 54.9979,
    "top": 76.196,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "145",
    "left": 60.7248,
    "top": 76.4813,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "146",
    "left": 66.9641,
    "top": 76.5384,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "147",
    "left": 72.4342,
    "top": 76.5384,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "148",
    "left": 77.9899,
    "top": 76.3672,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "149",
    "left": 83.2031,
    "top": 76.3101,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "150",
    "left": 90.126,
    "top": 76.4813,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "151",
    "left": 44.2289,
    "top": 82.1258,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "152",
    "left": 49.1866,
    "top": 81.8975,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "153",
    "left": 55.0835,
    "top": 81.9546,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "154",
    "left": 61.0659,
    "top": 81.8975,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "155",
    "left": 66.536,
    "top": 81.9546,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "156",
    "left": 72.4342,
    "top": 82.0687,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "157",
    "left": 77.8187,
    "top": 81.9546,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "158",
    "left": 83.46,
    "top": 82.0116,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "159",
    "left": 90.2116,
    "top": 81.8975,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "160",
    "left": 54.7423,
    "top": 87.9406,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "161",
    "left": 60.8104,
    "top": 87.8835,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "162",
    "left": 66.7929,
    "top": 87.8264,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "163",
    "left": 72.6054,
    "top": 87.5419,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "164",
    "left": 78.4166,
    "top": 87.7131,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "165",
    "left": 84.0579,
    "top": 87.5419,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "166",
    "left": 89.7849,
    "top": 87.5419,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "167",
    "left": 60.3823,
    "top": 92.9581,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "168",
    "left": 66.3661,
    "top": 92.9581,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "169",
    "left": 72.4342,
    "top": 92.901,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "170",
    "left": 78.331,
    "top": 92.9581,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "171",
    "left": 83.9723,
    "top": 92.7868,
    "w": 1.2842,
    "h": 0.8562
  },
  {
    "id": "172",
    "left": 90.0404,
    "top": 92.8439,
    "w": 1.2842,
    "h": 0.8562
  }
];
let idCounter = 1;
rowsCounts.forEach((count, rowIdx) => {
  const top = topStart + rowIdx * rowVGap;
  // calculate horizontal spacing: center the row in available width
  const totalWidth = 100 - hallPaddingLeft - hallPaddingRight;
  const rowSpace = totalWidth;
  const usedWidth = count * seatW;
  const gapTotal = Math.max(0, rowSpace - usedWidth);
  const gapBetween = gapTotal / (count + 1);
  let x = hallPaddingLeft + gapBetween; // first seat left %
  for (let c = 0; c < count; c++) {
    SEATS_CONFIG.push({
      id: idCounter.toString(),
      left: x,
      top: top,
      w: seatW,
      h: seatH
    });
    x += seatW + gapBetween;
    idCounter++;
  }
});

let seatsState = {}; // id -> status

async function fetchSeats() {
  try {
    const res = await fetch(API_URL + '?type=getSeats');
    const j = await res.json();
    if (!j.ok) { console.error('getSeats error', j); return; }
    j.seats.forEach(s => seatsState[s.id] = s.status);
    renderSeats();
  } catch (e) { console.error('fetchSeats err', e); }
}

function renderSeats() {
  const hall = document.getElementById('hall');
  // remove old seat elements
  hall.querySelectorAll('.seat').forEach(n => n.remove());
  SEATS_CONFIG.forEach(cfg => {
    const el = document.createElement('div');
    el.className = 'seat';
    const status = seatsState[cfg.id] || 'available';
    el.classList.add(status === 'pending' ? 'pending' : (status === 'sold' ? 'sold' : 'available'));
    el.style.left = cfg.left + '%';
    el.style.top = cfg.top + '%';
    el.style.width = cfg.w + '%';
    el.style.height = cfg.h + '%';
    el.dataset.id = cfg.id;
    el.innerText = cfg.id;
    if (status !== 'sold') el.addEventListener('click', onSeatClick);
    hall.appendChild(el);
  });
}

function onSeatClick(e) {
  const id = e.currentTarget.dataset.id;
  openModal(id);
}

/* Modal logic */
const modal = document.getElementById('modal');
const buyForm = document.getElementById('buyForm');
const seatIdInput = document.getElementById('seatId');
const modalTitle = document.getElementById('modalTitle');
const cancelBtn = document.getElementById('cancelBtn');
const formMsg = document.getElementById('formMsg');

function openModal(id) {
  seatIdInput.value = id;
  modalTitle.innerText = 'Выбрано место ' + id;
  formMsg.innerText = '';
  modal.classList.add('open');
}
function closeModal() { modal.classList.remove('open'); }
cancelBtn.addEventListener('click', ()=>closeModal());

buyForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  formMsg.innerText = 'Отправка...';
  const id = seatIdInput.value;
  const name = document.getElementById('name').value.trim();
  const surname = document.getElementById('surname').value.trim();
  const email = document.getElementById('email').value.trim();
  const fileInput = document.getElementById('receipt');
  if (!name || !email || !fileInput.files.length) { formMsg.innerText = 'Заполните обязательные поля.'; return; }
  const file = fileInput.files[0];
  try {
    const base64 = await readFileAsDataURL(file);
    const payload = { type:'reserve', id: id, name: name, surname: surname, email: email, receiptBase64: base64, receiptFilename: file.name };
    const r = await fetch(API_URL, { method:'POST', body: JSON.stringify(payload), headers:{ 'Content-Type':'application/json' }});
    const j = await r.json();
    if (j.ok) {
      formMsg.innerText = 'Резерв создан — ожидает подтверждения админом.';
      await fetchSeats();
      setTimeout(()=>closeModal(),1000);
    } else formMsg.innerText = 'Ошибка: ' + (j.error||'unknown');
  } catch(err){ formMsg.innerText = 'Ошибка сети: ' + err; }
});

function readFileAsDataURL(file){ return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }

/* initial load */
window.addEventListener('load', ()=>{ fetchSeats(); setInterval(fetchSeats, 15000); });
</script>
</body>
</html>




